---
interface Props {
  avatarSrc?: string;
}

const { avatarSrc = '/avatar.jpg' } = Astro.props;
---

<section class="pt-8 pb-16 md:pb-[64px]">
  <div class="container-narrow text-center">
    <!-- Avatar with decorative layer -->
    <div class="mb-10 opacity-0-init animate-scale-in delay-200">
      <div class="relative inline-block">
        <!-- Decorative background layer - vintage texture -->
        <div
          class="absolute rounded-full -z-10"
          style="
            width: calc(100% + 20px);
            height: calc(100% + 20px);
            top: 10px;
            left: 10px;
            background: repeating-linear-gradient(
              45deg,
              rgba(168, 85, 247, 0.1) 0px,
              rgba(168, 85, 247, 0.1) 2px,
              transparent 2px,
              transparent 8px
            ),
            radial-gradient(circle at 30% 30%, rgba(168, 85, 247, 0.15) 0%, transparent 50%);
          "
        ></div>

        <!-- Avatar -->
        <img
          src={avatarSrc}
          alt="头像"
          width="192"
          height="192"
          class="w-44 h-44 md:w-48 md:h-48 rounded-full object-cover relative z-10"
          style="
            border: 2px dashed #A855F7;
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.3);
          "
          onerror="this.src='https://api.dicebear.com/7.x/notionists/svg?seed=RollingTheRock'"
          loading="eager"
          decoding="async"
        />
      </div>
    </div>

    <!-- Tagline -->
    <div class="mb-10 opacity-0-init animate-fade-in-down delay-400">
      <h1
        class="hero-tagline text-2xl md:text-3xl lg:text-4xl leading-relaxed text-[var(--text-primary)]"
      >
        "Code Is the Answer. But I'm More Interested in the Question."
      </h1>
    </div>

    <!-- Subscribe Button with Gradient Border -->
    <div class="opacity-0-init animate-fade-in-down delay-600">
      <button
        id="hero-subscribe-btn"
        type="button"
        class="relative inline-flex items-center justify-center px-8 py-3 text-base font-medium text-[var(--text-primary)] transition-all duration-300 rounded-full group"
        style="
          background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(6, 182, 212, 0.1));
        "
      >
        <!-- Gradient border -->
        <span
          class="absolute inset-0 rounded-full p-[2px]"
          style="background: linear-gradient(135deg, #A855F7, #06B6D4);"
        >
          <span class="absolute inset-[2px] rounded-full bg-[var(--bg-primary)]"></span>
        </span>
        <span class="relative z-10 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          Subscribe
        </span>
      </button>
    </div>

    <!-- Expandable Subscribe Form -->
    <div
      id="hero-subscribe-form"
      class="max-w-md mx-auto mt-6 overflow-hidden transition-all duration-500 ease-out opacity-0 max-h-0"
    >
      <form
        class="flex flex-col sm:flex-row gap-3"
        onsubmit="event.preventDefault(); handleHeroSubscribe(event);"
      >
        <input
          type="email"
          name="email"
          placeholder="your@email.com"
          required
          class="flex-1 px-4 py-3 bg-[var(--bg-secondary)] border border-[var(--border-color)] rounded-lg text-[var(--text-primary)] placeholder-[var(--text-muted)] focus:outline-none focus:border-[#A855F7] transition-colors"
        />
        <button
          type="submit"
          class="px-6 py-3 bg-gradient-to-r from-[#A855F7] to-[#06B6D4] text-[var(--bg-primary)] font-medium rounded-lg hover:opacity-90 transition-opacity whitespace-nowrap"
        >
          订阅
        </button>
      </form>
      <p class="mt-3 text-xs text-[#666666]">
        订阅即表示同意接收更新邮件，可随时取消订阅。
      </p>
    </div>
  </div>
</section>

<script is:inline>
  // Toggle subscribe form
  document.addEventListener('DOMContentLoaded', function() {
    const subscribeBtn = document.getElementById('hero-subscribe-btn');
    const subscribeForm = document.getElementById('hero-subscribe-form');

    if (subscribeBtn && subscribeForm) {
      subscribeBtn.addEventListener('click', function() {
        const isExpanded = subscribeForm.classList.contains('opacity-100');

        if (isExpanded) {
          subscribeForm.classList.remove('opacity-100', 'max-h-48');
          subscribeForm.classList.add('opacity-0', 'max-h-0');
        } else {
          subscribeForm.classList.remove('opacity-0', 'max-h-0');
          subscribeForm.classList.add('opacity-100', 'max-h-48');
          // Focus on email input after animation
          setTimeout(() => {
            const emailInput = subscribeForm.querySelector('input[type="email"]');
            if (emailInput) emailInput.focus();
          }, 300);
        }
      });
    }
  });

  // Handle subscribe form submission
  function handleHeroSubscribe(event) {
    const form = event.target;
    const email = form.email.value;

    // TODO: Implement actual subscription logic
    // For now, show a success message
    alert('感谢订阅！我们会将最新内容发送到 ' + email);
    form.reset();

    // Collapse form after submission
    const subscribeForm = document.getElementById('hero-subscribe-form');
    if (subscribeForm) {
      subscribeForm.classList.remove('opacity-100', 'max-h-48');
      subscribeForm.classList.add('opacity-0', 'max-h-0');
    }
  }
</script>

---
import BaseLayout from '../layouts/BaseLayout.astro';
import Sidebar from '../components/Sidebar.astro';
import Subscribe from '../components/Subscribe.astro';
import BlogCard from '../components/BlogCard.astro';
import ProjectCard from '../components/ProjectCard.astro';
import { getCollection } from 'astro:content';
import { FEATURED_POSTS_COUNT, FEATURED_PROJECTS_COUNT } from '../utils/constants';

// Get featured posts and projects
const posts = await getCollection('blog', ({ data }) => !data.draft);
const projects = await getCollection('projects');

const featuredPosts = posts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, FEATURED_POSTS_COUNT);

const featuredProjects = projects
  .filter(p => p.data.featured)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, FEATURED_PROJECTS_COUNT);
---

<BaseLayout>
  <div class="max-w-wide mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-20">
    <div class="flex flex-col lg:flex-row gap-12">
      <!-- Main Content -->
      <main class="flex-1 page-transition">
        <!-- Hero Section -->
        <section class="mb-20 md:mb-32">
          <div class="max-w-2xl">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-serif font-bold leading-tight mb-6">
              探索技术，<br />
              <span class="text-[var(--text-secondary)]">分享思考</span>
            </h1>
            <p class="text-lg md:text-xl text-[var(--text-secondary)] mb-8 leading-relaxed">
              我是 RollingTheRock，一名热爱技术的开发者。
              这里记录我的学习历程、项目实践和技术思考。
            </p>
            <div class="flex flex-wrap gap-4">
              <a
                href="/blog"
                class="inline-flex items-center px-6 py-3 bg-[var(--text-primary)] text-[var(--bg-primary)] rounded-lg font-medium hover:opacity-90 transition-opacity"
              >
                阅读博客
                <svg class="ml-2" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
              </a>
              <a
                href="/projects"
                class="inline-flex items-center px-6 py-3 border border-[var(--border-color)] rounded-lg font-medium hover:bg-[var(--bg-secondary)] transition-colors"
              >
                查看项目
              </a>
            </div>
          </div>
        </section>

        <!-- Featured Posts Section -->
        {featuredPosts.length > 0 && (
          <section class="mb-20 md:mb-32">
            <div class="flex items-center justify-between mb-8">
              <h2 class="text-2xl md:text-3xl font-serif font-semibold">最新文章</h2>
              <a href="/blog" class="text-sm text-[var(--text-secondary)] hover:text-[var(--text-primary)] flex items-center gap-1">
                查看全部
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
              </a>
            </div>
            <div class="grid gap-8">
              {featuredPosts.map(post => (
                <BlogCard
                  title={post.data.title}
                  description={post.data.description}
                  slug={post.slug}
                  date={post.data.date}
                  categories={post.data.categories}
                  image={post.data.image}
                  layout="horizontal"
                />
              ))}
            </div>
          </section>
        )}

        <!-- Featured Projects Section -->
        {featuredProjects.length > 0 && (
          <section class="mb-20 md:mb-32">
            <div class="flex items-center justify-between mb-8">
              <h2 class="text-2xl md:text-3xl font-serif font-semibold">精选项目</h2>
              <a href="/projects" class="text-sm text-[var(--text-secondary)] hover:text-[var(--text-primary)] flex items-center gap-1">
                查看全部
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
              </a>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
              {featuredProjects.map(project => (
                <ProjectCard
                  title={project.data.title}
                  description={project.data.description}
                  slug={project.slug}
                  image={project.data.image}
                  tech={project.data.tech}
                  github={project.data.github}
                  demo={project.data.demo}
                />
              ))}
            </div>
          </section>
        )}

        <!-- Subscribe Section -->
        <section>
          <Subscribe showPrivacy={true} />
        </section>
      </main>

      <!-- Sidebar (Desktop only) -->
      <div class="hidden lg:block">
        <div class="sticky top-24">
          <Sidebar />
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const videos = await getCollection('videos');
const sortedVideos = videos.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

function formatDate(date: Date) {
  return new Intl.DateTimeFormat('zh-CN', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date);
}

function getPlatformName(platform: string) {
  return platform === 'bilibili' ? 'Bilibili' : 'YouTube';
}

function getEmbedUrl(video: typeof videos[0]) {
  if (video.data.platform === 'bilibili') {
    return `https://player.bilibili.com/player.html?bvid=${video.data.videoId}&page=1`;
  }
  return `https://www.youtube.com/embed/${video.data.videoId}`;
}
---

<BaseLayout title="è§†é¢‘" description="æˆ‘çš„è§†é¢‘å†…å®¹">
  <div class="max-w-wide mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-20">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-3xl md:text-4xl font-serif font-bold mb-4">è§†é¢‘</h1>
      <p class="text-[var(--text-secondary)] max-w-lg mx-auto">
        æˆ‘çš„è§†é¢‘å†…å®¹
      </p>
    </div>

    <!-- Videos Grid -->
    <div class="grid md:grid-cols-2 gap-8">
      {sortedVideos.map(video => (
        <article class="group">
          <a href={`/videos/${video.slug}`} class="block">
            <!-- Thumbnail with Play Button -->
            <div class="relative aspect-video overflow-hidden rounded-xl bg-[var(--bg-secondary)] img-hover">
              {video.data.thumbnail ? (
                <img
                  src={video.data.thumbnail}
                  alt={video.data.title}
                  class="w-full h-full object-cover"
                />
              ) : (
                <div class="w-full h-full flex items-center justify-center text-6xl">
                  ðŸŽ¬
                </div>
              )}
              <div class="absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/30 transition-colors">
                <div class="w-16 h-16 rounded-full bg-white/90 flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" class="text-black ml-1">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                  </svg>
                </div>
              </div>
            </div>

            <div class="mt-4">
              <h2 class="text-lg font-semibold group-hover:text-[var(--text-secondary)] transition-colors">
                {video.data.title}
              </h2>
              <p class="text-sm text-[var(--text-muted)] mt-1">
                {formatDate(video.data.date)} Â· {getPlatformName(video.data.platform)}
              </p>
            </div>
          </a>
        </article>
      ))}
    </div>

    <!-- Empty State -->
    {sortedVideos.length === 0 && (
      <div class="text-center py-20">
        <p class="text-[var(--text-muted)]">æš‚æ— è§†é¢‘ï¼Œæ•¬è¯·æœŸå¾…...</p>
      </div>
    )}
  </div>
</BaseLayout>
